(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[979],{7092:function(e,t,r){Promise.resolve().then(r.bind(r,940))},4848:function(e,t,r){"use strict";r.d(t,{Z:function(){return c}});var a=r(7437),i=r(9671),n=r.n(i);function c(e){let t=new Date(e.created).toLocaleString("en-GB",{year:"2-digit",month:"2-digit",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1});return(0,a.jsxs)("div",{className:n().cardItem,onClick:()=>e.clickHandler(e),children:[(0,a.jsxs)("p",{children:["Title: ",e.title]}),(0,a.jsxs)("p",{children:["Description: ",e.desc]}),(0,a.jsxs)("p",{children:["Price: ",e.price,"€"]}),(0,a.jsxs)("p",{children:["Owner: ",e.owner]}),(0,a.jsxs)("p",{children:["Status: ",e.status]}),(0,a.jsxs)("p",{children:["Created: ",t]})]})}},940:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var a=r(7437),i=r(9671),n=r.n(i),c=r(7138),s=r(2265);function l(){let[e,t]=(0,s.useState)("POPULATE DB"),r=async()=>{let e=await fetch("http://127.0.0.1:8000/populate/",{});t((await e.json()).message)};return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("button",{className:n().populatedb,onClick:()=>r(),children:e})})}var d=r(5482);function o(e){return(0,a.jsx)("div",{className:n().cartItem,children:(0,a.jsx)("div",{style:{},children:(0,a.jsxs)("div",{onClick:()=>e.clickHandler(e),children:[(0,a.jsxs)("p",{children:["Title: ",e.title]}),(0,a.jsxs)("p",{children:["Price: ",e.price,"€"]}),(0,a.jsxs)("p",{children:["Owner: ",e.owner]})]})})})}var h=r(4848);function u(){let e=localStorage.getItem("access_token"),[t,r]=(0,s.useState)([]),[i,c]=(0,s.useState)([]),[l,u]=(0,s.useState)([]),[p,f]=(0,s.useState)(""),[m,g]=(0,s.useState)(""),[j,x]=(0,s.useState)(""),_=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j;try{let t=e?"".concat(d.S,"/item/?search=").concat(e):"".concat(d.S,"/item/"),i=await fetch(t),n=await i.json(),c=n.map((e,t)=>(0,a.jsx)(h.Z,{title:e.title,desc:e.desc,price:e.price,owner:e.owner,status:e.status,created:e.created,clickHandler:()=>b(e)},t));return r(c),n}catch(e){g("Error fetching data:"+e.message)}},w=async function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await fetch("".concat(d.S,"/me"),{headers:{Authorization:"Bearer "+e},...r})},b=async e=>{g("");let t=await w(),r=(await t.text()).replace(/"/g,"");if(401===t.status){g("Not logged in");return}if(e.owner===r){g("Cannot add own items");return}if(-1!=i.findIndex(t=>t.created===e.created)&&-1!==i.findIndex(t=>t.title===e.title)){g("You cannot add the same item again");return}c(t=>[...t,e])},y=e=>{c(i.filter(t=>t.id!==e.id))},S=async()=>{let e=i.map((e,t)=>(0,a.jsx)(o,{title:e.title,price:e.price,owner:e.owner,clickHandler:()=>y(e)},t)),t=0;i.forEach(e=>{t+=Number(e.price)}),u(e),f(t.toString()),_()},E=async t=>{try{let r=await w(),a=(await r.text()).replace(/"/g,"");try{let r=await fetch("/api/purchase/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},body:JSON.stringify({price:t.price,title:t.title,desc:t.desc,owner:a,status:"PURCHASED"})});await r.json(),_()}catch(e){return e}let i=await fetch("/api/buy-item/".concat(t.id,"/"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},body:JSON.stringify({price:t.price,title:t.title,desc:t.desc,owner:t.owner,status:"SOLD"})}),n=await i.json();return _(),n}catch(e){return e}},v=async()=>{if(401===(await w()).status){g("Not logged in");return}if(0==i.length){g("Cart is empty");return}let e=await _(),t=[],r=[];e.forEach(e=>{i.forEach(r=>{e.id==r.id&&e.price!==r.price&&t.push(e)})}),i.forEach(t=>{let a=!1;e.forEach(e=>{t.id===e.id&&(a=!0)}),a||r.push(t)});let a="Error: ",n="Error: ";if(0!==t.length){t.forEach(e=>{a+="Price has changed for: "+e.title+",  "}),g(a+="Remove changed item(s) and try again!");return}if(0!==r.length){r.forEach(e=>{n+=e.title+" has already been bought,  "}),g(n+="Remove bought item(s) and try again!");return}i.forEach(e=>{E(e)}),c([]),f(""),g("Successfully bought items")};return(0,s.useEffect)(()=>{_(j)},[j]),(0,s.useEffect)(()=>{S()},[i]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("form",{className:n().form,onSubmit:e=>{e.preventDefault(),x(Object.fromEntries(new FormData(e.target).entries()).search.toString()),_(j)},children:[(0,a.jsxs)("label",{children:["Search:",(0,a.jsx)("input",{name:"search"})]}),(0,a.jsx)("button",{type:"submit",children:"Search"})]}),(0,a.jsxs)("div",{className:n().error,children:["  ",m," "]}),(0,a.jsxs)("div",{className:n().cardList,children:[" ",t," "]}),(0,a.jsxs)("div",{className:n().error,children:["  ",m," "]}),(0,a.jsxs)("div",{className:n().cart,children:[(0,a.jsx)("h1",{children:"CART"}),(0,a.jsxs)("p",{children:["Total items: ",i.length]}),(0,a.jsxs)("p",{children:["Total price: ",p,"€"]}),(0,a.jsx)("button",{onClick:v,children:"Pay"})]}),l]})}function p(){return(0,a.jsxs)("main",{className:n().main,children:[(0,a.jsxs)("nav",{className:n().navbar,children:[(0,a.jsx)("h1",{children:"WEB TECH."}),(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:(0,a.jsx)(c.default,{href:"./myitems",children:"MY ITEMS"})}),(0,a.jsx)("li",{children:(0,a.jsx)(c.default,{href:"./login/",children:"LOG IN"})}),(0,a.jsx)("li",{children:(0,a.jsx)(c.default,{href:"./signup",children:"SIGN UP"})}),(0,a.jsx)("li",{children:(0,a.jsx)(l,{})})]})]}),(0,a.jsx)(u,{})]})}},5482:function(e,t,r){"use strict";r.d(t,{S:function(){return a}});let a="/api"},9671:function(e){e.exports={main:"page_main__GlU4n",Label:"page_Label__shcnZ",navbar:"page_navbar__chktt",populatedb:"page_populatedb__Bqr3l",form:"page_form__Ou5d6",cardList:"page_cardList___XOFY",error:"page_error__Jil8M",cart:"page_cart__1D7QG",back:"page_back__mmxhE",cartItem:"page_cartItem__7B9lv",cardItem:"page_cardItem__57QEU"}}},function(e){e.O(0,[967,138,971,23,744],function(){return e(e.s=7092)}),_N_E=e.O()}]);